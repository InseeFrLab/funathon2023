---
title: Pr√©sentation du SSP Cloud
subtitle: |
  **[Et comment utiliser Git dessus]{.orange}**
author: Lino Galiana
slide-number: true
footer: |
  Funathon 2023
# uncomment for French presentations:
lang: fr-FR
# for blind readers:
slide-tone: false
# for @olevitt:
chalkboard: # press the B key to toggle chalkboard
  theme: whiteboard
# uncomment to use the multiplex mode:
#multiplex: true
format:
  # pick the light mode (onyxia-revealjs) or the dark mode (onyxia-dark-revealjs)
  onyxia-revealjs:
  #onyxia-dark-revealjs:
    output-file: light.html
controls: true
css: custom.css
from: markdown+emoji
---

# Le SSP Cloud, c'est quoi ?


## Un environnement id√©al pour la formation {.smaller}

- Plateforme disponible depuis <https://datalab.sspcloud.fr/>
    + Pour d√©couvrir et exp√©rimenter... 
    + ... **Seulement avec des donn√©es en open data**

. . .

- Une plateforme pour l'administration :
    + Ouverte aux agents de l'Etat et √† des formations en _data science_ (ENSAE...)
    + Des serveurs h√©berg√©s √† l'Insee

. . .

::: {.callout-important}

__Plateforme recommand√©e pour cet √©v√©nement__

- Signalez-nous si vous ne pouvez cr√©er de compte !

:::

## Un environnement id√©al pour l'analyse de donn√©es

![](https://git.lab.sspcloud.fr/diit/presentation/energy-data-hack-2022/20220523-day_1-onyxia_onboarding/-/raw/main/slideshow/onyxia_galaxy.png){width=80%}

## En plus, le SSP Cloud, c'est wahou ! üòç

![](https://git.lab.sspcloud.fr/diit/presentation/energy-data-hack-2022/20220523-day_1-onyxia_onboarding/-/raw/main/slideshow/macbook_onyxia.png)

__<https://datalab.sspcloud.fr>__


# Principe de la plateforme


## Une plateforme pour la reproductibilit√© et la libert√© {.smaller}

- Vous passez un contrat avec le `SSP Cloud` pour cr√©er
un `RStudio` ou `Jupyter`
    + Celui-ci tourne sur des
serveurs distants auxquels vous acc√©dez via le navigateur

. . .

- Environnement initialement __standardis√©__ :
    + Tout le monde part du m√™me socle minimal
    + __Libert√©__ d'installer des packages ou librairies Linux


## Une plateforme pour les bonnes pratiques {.smaller}

<details>
<summary>
Dans un environnement diff√©rent
</summary>
![](https://ensae-reproductibilite.github.io/website/workflow1.png)

_Source_: [https://ensae-reproductibilite.github.io](https://ensae-reproductibilite.github.io/website/chapters/application.html)
</details>

- [__Environnements temporaires__]{.orange} donc:
    + Stocker le [__code__]{.blue2} dans un endroit p√©renne: `Github`, `Gitlab`
    + Stocker les [__donn√©es__]{.blue2} dans un endroit p√©renne: `MinIO`


<details>
<summary>
Dans le cadre du _Funathon_
</summary>
![](/img/config.png)
</details>

<details>
<summary>
Pour ceux voulant aller (vraiment) plus loin
</summary>
![](https://ensae-reproductibilite.github.io/website/workflow2.png)

_Source_: [https://ensae-reproductibilite.github.io](https://ensae-reproductibilite.github.io/website/chapters/application.html)
</details>


::: {.callout-note}
Les services durent plusieurs jours mais n'ont __pas vocation √† persister__
:::

## Des services standardis√©s pour les gouverner tous

![](img/onyxia_galaxy_1.png)

## Un syst√®me de stockage p√©renne pour les donn√©es

![](img/onyxia_galaxy_2.png)

## Quand `R` ou `Python` ne suffisent plus

Des technologies sp√©ciales pour les bases de donn√©es

![](img/onyxia_galaxy_3.png)

## Quand `R` ou `Python` ne suffisent plus

Des technologies adapt√©es aux donn√©es volumineuses

![](img/onyxia_galaxy_4.png)


## Bonus

Les statisticiens ayant d√©couvert le `SSPCloud`, quand ils
doivent revenir √† leur infra habituelle

![](https://images.theconversation.com/files/504051/original/file-20230111-22-t4yssf.png?ixlib=rb-1.1.0&rect=22%2C2%2C873%2C530&q=45&auto=format&w=926&fit=clip)


# Onboarding

## _Checklist_

- [ ] Cr√©er un compte
- [ ] Se connecter
- [ ] Trouver de l'aide
- [ ] Lancer un service de _data science_ (`R`, `Jupyter`...)
- [ ] Utiliser `Git`
- [ ] Utiliser le stockage objet `MinIO`


## Cr√©er un compte

- Aller sur <https://datalab.sspcloud.fr> puis `Connexion` et `Cr√©er un compte`
    + Utiliser une adresse mail d'un domaine autoris√© ([@insee.fr]{.blue2}, [@..gouv.fr]{.blue2}...)
    + Domaines [@gmail.com]{.blue2}, [@yahoo.fr]{.blue2}... non admis
    + Seuls les domaines institutionnels sont autoris√©s (universit√©s, √©coles, administrations...)  

. . .

- Si besoin, demandez-nous pour rajouter un domaine
 

## Se connecter

- Aller sur <https://datalab.sspcloud.fr>
- Cliquer sur `Connexion`


## Trouver de l'aide

- Documentation : <https://docs.sspcloud.fr/>

. . .

- Portail de la formation √† mettre en ‚≠êÔ∏è : <https://www.sspcloud.fr/formation>

. . .

- Poser des questions sur les fils `Tchap`:
    + [`SSPCloud`](https://matrix.to/#/#SSPCloudXDpAw6v:agent.finances.tchap.gouv.fr) de mani√®re g√©n√©rale ;
    + [`Insee - SSPLab - Funathon 2023`](https://matrix.to/#/#funathon2023:agent.finances.tchap.gouv.fr) pendant cet √©v√©nement ;

## Lancer un service de data science

<https://docs.sspcloud.fr/onyxia-guide/premiere-utilisation>

- Chaque service poss√®de un `README`, [__lisez-le üòâ__]{.red2}

. . .

- Chaque service est prot√©g√© par un mot de passe, __copiez-le__

. . . 

- Les **services** sont **√©ph√©m√®res**  
    + **Utilisez `Git`** (avec `Github` ou `Gitlab`) pour sauvegarder vos notebooks et codes  
    + **Utilisez `MinIO`** pour sauvegarder vos donn√©es
    + __sinon vous pourriez perdre votre travail__


## Utiliser `Git`

<https://docs.sspcloud.fr/onyxia-guide/controle-de-version>

- Obligatoire pour ne pas perdre de travail (notebooks et codes)
- Indispensable pour collaborer
- Compatible avec la forge de votre choix (`GitHub`, `GitLab`...)


## Utiliser le stockage objet `MinIO`

<https://docs.sspcloud.fr/onyxia-guide/stockage-de-donnees>

- Pour d√©poser ses donn√©es comme si on avait un service de fichier local
- Chaque utilisateur a un bucket personnel
- Possibilit√© de rendre des donn√©es publiques
- Librairies `Python` (`Boto3` ou `S3Fs`) ou `R` (`aws.s3`)

## Utiliser le stockage objet `MinIO`

![](/img/minio1.png)

## Lancer un service pr√™t-√†-l'emploi

- Un exemple avec `R` ([Explorer la g√©ographie des cultures agricoles fran√ßaises](https://github.com/InseeFrLab/funathon2023_sujet2))

[![](https://img.shields.io/badge/Launch-Datalab-orange?logo=R)](https://datalab.sspcloud.fr/launcher/ide/rstudio?autoLaunch=false&onyxia.friendlyName=%C2%ABSujet%202%C2%BB&init.personalInit=%C2%ABhttps%3A%2F%2Fraw.githubusercontent.com%2FInseeFrLab%2Ffunathon2023_sujet2%2Fmain%2Finit.sh%C2%BB)

- Un exemple avec `Python` ([Mon `Yuka` avec `Python`](https://github.com/InseeFrLab/funathon2023_sujet4))

[![](https://img.shields.io/badge/SSPcloud-Tester%20via%20SSP--cloud-informational&color=yellow?logo=Python)](https://datalab.sspcloud.fr/launcher/ide/jupyter-python?autoLaunch=true&kubernetes.role=%C2%ABadmin%C2%BB&networking.user.enabled=true&git.cache=%C2%AB36000%C2%BB&init.personalInit=%C2%ABhttps%3A%2F%2Fraw.githubusercontent.com%2FInseeFrLab%2Ffunathon2023_sujet4%2Fmain%2Finit.sh%C2%BB)


# `Git`: quelques concepts

## Pourquoi faire du contr√¥le de version ? 

- [__Construire__]{.blue2} et [__naviguer__]{.blue2} √† travers l'[**historique**]{.orange} de son projet

. . .

- La [**collaboration**]{.orange} rendue [__simple__]{.blue2} et [__efficace__]{.blue2}

. . .

- Am√©liorer la [**reproductibilit√©**]{.orange} de ses projets

. . .

- Am√©liorer la [**visibilit√©**]{.orange} de ses projets


::: {.callout-note}
Plus d'√©l√©ments dans la [formation officielle](https://inseefrlab.github.io/formation-bonnes-pratiques-git-R/)
:::


## Gymnastique

![](https://inseefrlab.github.io/formation-bonnes-pratiques-git-R/slides/img/localremote.png){fig-align="center" height=400}

- Par d√©faut, le d√©p√¥t distant porte l'alias `origin`

## Ressources suppl√©mentaires {.smaller}

- Pour **aller plus loin**:
    - [Formation aux bonnes pratiques avec `Git` et `R`](https://inseefrlab.github.io/formation-bonnes-pratiques-git-R)
    - [Introduction √† `Git` pour `Python`](https://pythonds.linogaliana.fr/exogit/)
    - La [documentation `utilitR`](https://www.book.utilitr.org/) propose plusieurs chapitres sur `Git`
    - La [Bible](https://git-scm.com/book/en/v2) de l'usage de `Git`


# Illustration par la pratique avec `RStudio` üöÄ

## Objectif {.smaller}

- D√©couvrir `S3`
- D√©couvrir `Git` √† travers l'interface `RStudio`
- D√©couvrir l'interaction entre `Git`, `RStudio` et `Gitlab`
- Se familiariser avec quelques concepts de `Git`

. . . 

- __[M√©thode pr√©conis√©e pour `Git`]{.blue2}__:
    + On propose de travailler sur la m√™me branche...
    + ... mais des fichiers s√©par√©s.
    + Evite l'utilisation de branches tout en limitant les conflits.


. . .

- **Trouver de l'aide**:
    - Pour toute question : le salon Tchap [Insee-Git-Gitlab](https://tchap.gouv.fr/#/room/#InseeGitGitlablPtu8f1Frns:agent.finances.tchap.gouv.fr)
    - A l'Insee : la [documentation utilisateurs](https://gitlab.insee.fr/infrastructure/lss/ausv3/documentation-utilisateurs/-/wikis/Logiciels/Git) pour l'utilisation de `Git` sur `AUS`
    - Sollicitez vos coll√®gues utilisateurs de `Git` !



## D√©monstration üöÄ

Exemple √† partir du [sujet 2](https://github.com/InseeFrLab/funathon2023_sujet2)
[![](https://img.shields.io/badge/Launch-Datalab-orange?logo=R)](https://datalab.sspcloud.fr/launcher/ide/rstudio?autoLaunch=false&onyxia.friendlyName=%C2%ABSujet%202%C2%BB&init.personalInit=%C2%ABhttps%3A%2F%2Fraw.githubusercontent.com%2FInseeFrLab%2Ffunathon2023_sujet2%2Fmain%2Finit.sh%C2%BB)

## Aide-m√©moire `S3`

<details>
<summary>Exemples issus d'[utilitR](https://www.book.utilitr.org/01_r_insee/fiche_utiliser_rstudio_sspcloud#liens-utiles)
</summary>

```r
bucket <- "donnees-insee"
aws.s3::get_bucket(bucket, region = "")
df <- 
  aws.s3::s3read_using(
    FUN = data.table::fread,
    # Mettre les options de FUN ici
    object = "diffusion/FILOSOFI/2016/FILOSOFI_COM.csv",
    bucket = "donnees-insee",
    opts = list("region" = "")
  )
aws.s3::s3write_using(
  df,
  FUN = data.table::fwrite,
  # Les options de fread sont ici
  sep = " ;",
  col.names = TRUE,
  object = "data/filosofi2016_example.csv",
  bucket = "MON_BUCKET_A_REMPLACER",
  opts = list("region" = "")
)
```
</details>

<details>
<summary>Exemples additionnels li√©s au Funathon
</summary>

```r
bucket <- "donnees-funathon"
aws.s3::get_bucket(bucket, region = "", prefix = "2023/sujet2/diffusion")
```
</details>



# Illustration par la pratique avec `Jupyter` üöÄ

## D√©monstration üöÄ

Exemple √† partir du [sujet 4](https://github.com/InseeFrLab/funathon2023_sujet4)
[![](https://img.shields.io/badge/SSPcloud-Tester%20via%20SSP--cloud-informational&color=yellow?logo=Python)](https://datalab.sspcloud.fr/launcher/ide/jupyter-python?autoLaunch=false&kubernetes.role=%C2%ABadmin%C2%BB&networking.user.enabled=true&git.cache=%C2%AB36000%C2%BB&init.personalInit=%C2%ABhttps%3A%2F%2Fraw.githubusercontent.com%2FInseeFrLab%2Ffunathon2023_sujet4%2Fmain%2Finit.sh%C2%BB)



## Aide-m√©moire `S3`

Voir <https://pythonds.linogaliana.fr/reads3/>

## `Git`

Voir <https://pythonds.linogaliana.fr/exogit/>

## Questions
